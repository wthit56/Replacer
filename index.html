<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title></title>
    </head>
    <body>
        <script src="commented.js" type="text/javascript"></script>
		<script type="text/javascript">
  	// console shim
	if (!window.console) { window.console = {}; }
  	if (!console.log) { console.log = function (messages) { }; }
  	if (!console.group) { console.group = function (name) { console.log("> " + name); } }
  	if (!console.groupEnd) { console.groupEnd = function () { }; }

  	var replaced, p = "PASS", f = "**************FAIL*****************";

  	console.group("var a = regexFind > stringReplace");
  	var a = Replacer(/a(?=(h))/g, "[a:$$|$&|$`|$'|$1]");
  	console.log("find: ", a.find);
  	console.log("replace: ", a.replace);
  	console.log("blahblah > " + (replaced = a("blahblah")));
  	console.log((replaced === "bl[a:$|a|bl|hblah|h]hbl[a:$|a|blahbl|h|h]h") ? p : f);
  	console.groupEnd();

  	console.group("var b = stringFind > stringReplace");
  	var b = Replacer("a", "[b:$$|$&|$`|$'|$1]");
  	console.log("find: ", b.find);
  	console.log("replace: ", b.replace);
  	console.log("blahblah > " + (replaced = b("blahblah")));
  	console.log((replaced === "bl[b:$|a|bl|hblah|$1]hblah") ? p : f);
  	console.groupEnd();

  	console.group("var c = regexFind > functionReplace");
  	var c = Replacer(/a/g, function (match) { return match.toUpperCase(); });
  	console.log("find: ", c.find);
  	console.log("replace: ", c.replace);
  	console.log("blahblah > " + (replaced = c("blahblah")));
  	console.log((replaced === "blAhblAh") ? p : f);
  	console.groupEnd();

  	console.group("var d = stringFind > functionReplace");
  	var d = Replacer("a", function (match) { return match.toUpperCase(); });
  	console.log("find: ", d.find);
  	console.log("replace: ", d.replace);
  	console.log("blahblah > " + (replaced = d("blahblah")));
  	console.log((replaced === "blAhblah") ? p : f);
  	console.groupEnd();

  	console.group("var e = aggregate");
  	var e = Replacer.aggregate(
  	    { find: /a/, replace: "[e:$$|$`|$&|$']" },
  	    { find: /(h)/, replace: "[e2:$1]" },
  	    {
  	    	find: /b(l)/,
  	    	replace: function (match, l) { return match + "[e3:" + l.toUpperCase() + "]"; }
  	    }
  	).setFlags("gim");
  	console.log("find: ", e.find);
  	console.log("find base: ", e.find.base);
  	console.log("replace: ", e.replace.base);
  	console.log("setFlags: ", "gim");
  	console.log("blahblah > " + (replaced = e("blahblah")));
  	console.log((replaced === "bl[e3:L][e:$|bl|a|hblah][e2:h]bl[e3:L][e:$|blahbl|a|h][e2:h]") ? p : f);
  	console.groupEnd();

  	console.group("var f = nested aggregate");
  	var f = Replacer.aggregate(
  	    { find: /hb/g, replace: "[f:$&]" },
  	    e
  	);
  	console.log("find: ", f.find);
  	console.log("find base: ", f.find.base);
  	console.log("replace: ", f.replace.base);
  	console.log("blahblah > " + (replaced = f("blahblah")));
  	console.log((replaced === "bl[e3:L][e:$|bl|a|hblah][f:hb]l[e:$|blahbl|a|h][e2:h]") ? p : f);
  	console.groupEnd();

  	console.group("var g = aggregate + group-reference");
  	var g = Replacer.aggregate(
  	    { find: /\s*blah\s*/g, replace: "" },
  	    { find: /([#\|])([\W\w]*?)\1/g, replace: "[$1]<$2>" }
  	);
  	console.log("find: ", g.find);
  	console.log("find base: ", g.find.base);
  	console.log("replace: ", g.replace.base);
  	console.log("blah #1# |2| > " + (replaced = g("blah #1# |2|")));
  	console.log((replaced === "[#]<1> [|]<2>") ? p : f);
  	console.groupEnd();

  	console.group("failed groupIndex fix");
  	try {
  		Replacer.aggregate(
  	        { find: /()()()()()()()/g, replace: "" },
  	        { find: /([#\|])([\W\w]*?)\1/g, replace: "[$1]<$2>" }
  	    );
  	}
  	catch (error) {
  		console.error(error.message);
  		replaced = true;
  	}
  	console.log((replaced === true) ? p : f);
  	console.groupEnd();
		</script>
    </body>
</html>
